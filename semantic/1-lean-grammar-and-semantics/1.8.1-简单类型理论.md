# 1.8.1 简单类型理论

[上一节：1.8 类型论理论模型](./1.8-类型论理论模型.md) | [返回总览](../README.md) | [下一节：1.8.2 依赖类型理论](./1.8.2-依赖类型理论.md)

---

## 概述

简单类型理论是类型理论的基础，为Lean语言提供了基本的类型系统框架。本章节详细介绍了简单类型λ演算、类型推导算法和类型安全性理论。

## 1. 简单类型λ演算

### 1.1 语法定义

**定义 1.1.1 (简单类型λ演算语法)**
简单类型λ演算的语法定义如下：

$$\begin{align}
\tau &::= \text{Bool} \mid \text{Nat} \mid \tau_1 \rightarrow \tau_2 \mid \tau_1 \times \tau_2 \\
e &::= x \mid \lambda x:\tau.e \mid e_1 e_2 \mid \text{true} \mid \text{false} \mid \text{if } e \text{ then } e_1 \text{ else } e_2 \\
& \quad \mid 0 \mid \text{succ } e \mid \text{pred } e \mid \text{iszero } e \\
& \quad \mid (e_1, e_2) \mid \text{fst } e \mid \text{snd } e
\end{align}$$

### 1.2 类型规则

**公理 1.2.1 (变量规则)**
$$\frac{x : \tau \in \Gamma}{\Gamma \vdash x : \tau}$$

**公理 1.2.2 (抽象规则)**
$$\frac{\Gamma, x : \tau_1 \vdash e : \tau_2}{\Gamma \vdash \lambda x:\tau_1.e : \tau_1 \rightarrow \tau_2}$$

**公理 1.2.3 (应用规则)**
$$\frac{\Gamma \vdash e_1 : \tau_1 \rightarrow \tau_2 \quad \Gamma \vdash e_2 : \tau_1}{\Gamma \vdash e_1 e_2 : \tau_2}$$

**公理 1.2.4 (布尔常量)**
$$\frac{}{\Gamma \vdash \text{true} : \text{Bool}} \quad \frac{}{\Gamma \vdash \text{false} : \text{Bool}}$$

**公理 1.2.5 (条件表达式)**
$$\frac{\Gamma \vdash e : \text{Bool} \quad \Gamma \vdash e_1 : \tau \quad \Gamma \vdash e_2 : \tau}{\Gamma \vdash \text{if } e \text{ then } e_1 \text{ else } e_2 : \tau}$$

### 1.3 自然数类型

**公理 1.3.1 (零)**
$$\frac{}{\Gamma \vdash 0 : \text{Nat}}$$

**公理 1.3.2 (后继)**
$$\frac{\Gamma \vdash e : \text{Nat}}{\Gamma \vdash \text{succ } e : \text{Nat}}$$

**公理 1.3.3 (前驱)**
$$\frac{\Gamma \vdash e : \text{Nat}}{\Gamma \vdash \text{pred } e : \text{Nat}}$$

**公理 1.3.4 (零判断)**
$$\frac{\Gamma \vdash e : \text{Nat}}{\Gamma \vdash \text{iszero } e : \text{Bool}}$$

### 1.4 积类型

**公理 1.4.1 (积类型形成)**
$$\frac{\Gamma \vdash \tau_1 : \text{Type} \quad \Gamma \vdash \tau_2 : \text{Type}}{\Gamma \vdash \tau_1 \times \tau_2 : \text{Type}}$$

**公理 1.4.2 (积类型引入)**
$$\frac{\Gamma \vdash e_1 : \tau_1 \quad \Gamma \vdash e_2 : \tau_2}{\Gamma \vdash (e_1, e_2) : \tau_1 \times \tau_2}$$

**公理 1.4.3 (积类型消除)**
$$\frac{\Gamma \vdash e : \tau_1 \times \tau_2}{\Gamma \vdash \text{fst } e : \tau_1} \quad \frac{\Gamma \vdash e : \tau_1 \times \tau_2}{\Gamma \vdash \text{snd } e : \tau_2}$$

## 2. 操作语义

### 2.1 小步语义

**定义 2.1.1 (小步归约关系)**
小步归约关系 $\rightarrow$ 定义如下：

**规则 2.1.1 (β归约)**
$$(\lambda x:\tau.e_1) e_2 \rightarrow e_1[e_2/x]$$

**规则 2.1.2 (条件真)**
$$\text{if true then } e_1 \text{ else } e_2 \rightarrow e_1$$

**规则 2.1.3 (条件假)**
$$\text{if false then } e_1 \text{ else } e_2 \rightarrow e_2$$

**规则 2.1.4 (前驱零)**
$$\text{pred } 0 \rightarrow 0$$

**规则 2.1.5 (前驱后继)**
$$\text{pred } (\text{succ } e) \rightarrow e$$

**规则 2.1.6 (零判断零)**
$$\text{iszero } 0 \rightarrow \text{true}$$

**规则 2.1.7 (零判断后继)**
$$\text{iszero } (\text{succ } e) \rightarrow \text{false}$$

**规则 2.1.8 (积类型投影)**
$$\text{fst } (e_1, e_2) \rightarrow e_1 \quad \text{snd } (e_1, e_2) \rightarrow e_2$$

### 2.2 大步语义

**定义 2.2.1 (大步求值关系)**
大步求值关系 $\Downarrow$ 定义如下：

**规则 2.2.1 (值)**
$$\frac{}{\text{true} \Downarrow \text{true}} \quad \frac{}{\text{false} \Downarrow \text{false}} \quad \frac{}{0 \Downarrow 0}$$

**规则 2.2.2 (后继)**
$$\frac{e \Downarrow v}{\text{succ } e \Downarrow \text{succ } v}$$

**规则 2.2.3 (应用)**
$$\frac{e_1 \Downarrow \lambda x:\tau.e \quad e_2 \Downarrow v_2 \quad e[v_2/x] \Downarrow v}{e_1 e_2 \Downarrow v}$$

## 3. 类型安全性

### 3.1 类型保持性

**定理 3.1.1 (类型保持性)**
如果 $\Gamma \vdash e : \tau$ 且 $e \rightarrow e'$，则 $\Gamma \vdash e' : \tau$。

**证明：** 通过结构归纳法证明。对于每个归约规则：

1. **β归约**：通过替换引理
2. **条件归约**：通过类型规则
3. **算术归约**：通过类型规则
4. **积类型归约**：通过类型规则

### 3.2 进展性

**定理 3.2.1 (进展性)**
如果 $\emptyset \vdash e : \tau$，则要么 $e$ 是值，要么存在 $e'$ 使得 $e \rightarrow e'$。

**证明：** 通过结构归纳法证明。对于每个语法构造：

1. **变量**：不可能（空上下文）
2. **抽象**：是值
3. **应用**：通过归纳假设
4. **条件**：通过归纳假设
5. **算术运算**：通过归纳假设
6. **积类型**：通过归纳假设

### 3.3 强正规化

**定理 3.3.1 (强正规化)**
在简单类型λ演算中，所有良类型的项都是强正规化的。

**证明：** 通过逻辑关系方法证明。

## 4. 类型推导算法

### 4.1 Hindley-Milner类型系统

**定义 4.1.1 (类型变量)**
类型变量 $\alpha, \beta, \gamma, \ldots$ 表示未知类型。

**定义 4.1.2 (类型模式)**
类型模式 $\sigma ::= \tau \mid \forall \alpha.\sigma$

**定义 4.1.3 (类型实例化)**
$$\frac{\Gamma \vdash e : \forall \alpha.\sigma}{\Gamma \vdash e : \sigma[\alpha \mapsto \tau]}$$

### 4.2 统一算法

**算法 4.2.1 (Robinson统一算法)**
```lean
def unify (t1 t2 : Type) : Option Substitution :=
  match t1, t2 with
  | TVar α, t => if α ∈ freeVars t then none else some [(α, t)]
  | t, TVar α => unify (TVar α) t
  | TArrow t1 t2, TArrow t1' t2' =>
    match unify t1 t1' with
    | some s1 =>
      match unify (apply s1 t2) (apply s1 t2') with
      | some s2 => some (compose s2 s1)
      | none => none
    | none => none
  | TCon a, TCon b => if a = b then some [] else none
  | _, _ => none
```

**定理 4.2.1 (统一算法正确性)**
如果统一算法成功，则返回的替换是最一般的一致替换。

## 5. Lean中的简单类型

### 5.1 基础类型

```lean
-- 布尔类型
def Bool : Type := Bool

-- 自然数类型
def Nat : Type := Nat

-- 函数类型
def Function (α β : Type) : Type := α → β

-- 积类型
def Product (α β : Type) : Type := α × β
```

### 5.2 类型推导示例

```lean
-- 简单函数
def add (x y : Nat) : Nat := x + y

-- 高阶函数
def twice (f : Nat → Nat) (x : Nat) : Nat := f (f x)

-- 积类型使用
def swap (p : α × β) : β × α := (p.2, p.1)
```

## 6. 相关链接

### 6.1 上级主题
- [1.8 类型论理论模型](./1.8-类型论理论模型.md)

### 6.2 下级主题
- [1.8.2 依赖类型理论](./1.8.2-依赖类型理论.md)

### 6.3 相关主题
- [1.9 证明论与推理系统](./1.9-证明论与推理系统.md)
- [1.10 模型论与语义模型](./1.10-模型论与语义模型.md)
- [2.2 类型论与证明论基础](../2-lean-形式化理论基础/2.2-类型论与证明论基础.md)

---

**最后更新**：2025-01-01  
**版本**：v2025-01  
**维护者**：Lean语义分析项目组
