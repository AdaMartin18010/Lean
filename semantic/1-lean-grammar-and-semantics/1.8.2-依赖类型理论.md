# 1.8.2 依赖类型理论

[上一节：1.8.1 简单类型理论](./1.8.1-简单类型理论.md) | [返回总览](../README.md) | [下一节：1.8.3 线性类型理论](./1.8.3-线性类型理论.md)

---

## 概述

依赖类型理论是类型理论的重要扩展，允许类型依赖于值，为Lean语言提供了强大的类型表达能力。本章节详细介绍了Π类型、Σ类型和依赖类型系统的核心理论。

## 1. 依赖类型基础

### 1.1 依赖类型语法

**定义 1.1.1 (依赖类型语法)**
依赖类型系统的语法定义如下：

$$\begin{align}
\tau &::= \text{Type} \mid \Pi x:\tau_1.\tau_2 \mid \Sigma x:\tau_1.\tau_2 \mid \tau_1 \rightarrow \tau_2 \\
e &::= x \mid \lambda x:\tau.e \mid e_1 e_2 \mid (e_1, e_2) \mid \text{fst } e \mid \text{snd } e \\
& \quad \mid \text{let } x = e_1 \text{ in } e_2
\end{align}$$

### 1.2 类型层次

**定义 1.2.1 (类型层次)**
类型层次结构定义如下：

$$\text{Type}_0 : \text{Type}_1 : \text{Type}_2 : \cdots$$

**公理 1.2.1 (类型层次公理)**
$$\frac{\Gamma \vdash A : \text{Type}_i}{\Gamma \vdash A : \text{Type}_{i+1}}$$

## 2. Π类型（依赖函数类型）

### 2.1 Π类型规则

**定义 2.1.1 (Π类型形成)**
$$\frac{\Gamma \vdash A : \text{Type} \quad \Gamma, x : A \vdash B : \text{Type}}{\Gamma \vdash \Pi x : A.B : \text{Type}}$$

**公理 2.1.1 (Π类型引入)**
$$\frac{\Gamma, x : A \vdash e : B}{\Gamma \vdash \lambda x : A.e : \Pi x : A.B}$$

**公理 2.1.2 (Π类型消除)**
$$\frac{\Gamma \vdash e_1 : \Pi x : A.B \quad \Gamma \vdash e_2 : A}{\Gamma \vdash e_1 e_2 : B[e_2/x]}$$

### 2.2 Π类型性质

**定理 2.2.1 (Π类型β归约)**
$$(\lambda x : A.e_1) e_2 \rightarrow e_1[e_2/x]$$

**定理 2.2.2 (Π类型η归约)**
$$\lambda x : A.(e x) \rightarrow e \quad \text{(当 } x \text{ 不在 } e \text{ 中自由出现)}$$

### 2.3 非依赖函数类型

**定义 2.3.1 (非依赖函数类型)**
当 $B$ 不依赖于 $x$ 时，$\Pi x : A.B$ 简化为 $A \rightarrow B$：

$$A \rightarrow B \equiv \Pi x : A.B \quad \text{(当 } x \text{ 不在 } B \text{ 中自由出现)}$$

## 3. Σ类型（依赖积类型）

### 3.1 Σ类型规则

**定义 3.1.1 (Σ类型形成)**
$$\frac{\Gamma \vdash A : \text{Type} \quad \Gamma, x : A \vdash B : \text{Type}}{\Gamma \vdash \Sigma x : A.B : \text{Type}}$$

**公理 3.1.1 (Σ类型引入)**
$$\frac{\Gamma \vdash e_1 : A \quad \Gamma \vdash e_2 : B[e_1/x]}{\Gamma \vdash (e_1, e_2) : \Sigma x : A.B}$$

**公理 3.1.2 (Σ类型消除)**
$$\frac{\Gamma \vdash e : \Sigma x : A.B \quad \Gamma, x : A, y : B \vdash e' : C}{\Gamma \vdash \text{let } (x, y) = e \text{ in } e' : C}$$

### 3.2 Σ类型性质

**定理 3.2.1 (Σ类型β归约)**
$$\text{let } (x, y) = (e_1, e_2) \text{ in } e' \rightarrow e'[e_1/x, e_2/y]$$

**定理 3.2.2 (Σ类型η归约)**
$$e \rightarrow (\text{fst } e, \text{snd } e)$$

### 3.3 非依赖积类型

**定义 3.3.1 (非依赖积类型)**
当 $B$ 不依赖于 $x$ 时，$\Sigma x : A.B$ 简化为 $A \times B$：

$$A \times B \equiv \Sigma x : A.B \quad \text{(当 } x \text{ 不在 } B \text{ 中自由出现)}$$

## 4. 依赖类型系统

### 4.1 上下文规则

**定义 4.1.1 (上下文形成)**
$$\frac{}{\emptyset \text{ ctx}} \quad \frac{\Gamma \text{ ctx} \quad \Gamma \vdash A : \text{Type}}{\Gamma, x : A \text{ ctx}}$$

**定义 4.1.2 (变量规则)**
$$\frac{\Gamma, x : A, \Gamma' \text{ ctx}}{\Gamma, x : A, \Gamma' \vdash x : A}$$

### 4.2 类型转换

**定义 4.2.1 (类型转换)**
$$\frac{\Gamma \vdash e : A \quad \Gamma \vdash A \equiv B : \text{Type}}{\Gamma \vdash e : B}$$

**定义 4.2.2 (类型等价)**
类型等价关系 $\equiv$ 是自反、对称、传递的，并且满足：

1. **β等价**：$(\lambda x : A.e_1) e_2 \equiv e_1[e_2/x]$
2. **η等价**：$\lambda x : A.(e x) \equiv e$
3. **π等价**：$\Pi x : A.B \equiv \Pi x : A'.B'$ 当 $A \equiv A'$ 且 $B \equiv B'$

## 5. 依赖类型语义

### 5.1 指称语义

**定义 5.1.1 (Π类型语义)**
$$\llbracket \Pi x : A.B \rrbracket_\rho = \prod_{a \in \llbracket A \rrbracket_\rho} \llbracket B \rrbracket_{\rho[x \mapsto a]}$$

**定义 5.1.2 (Σ类型语义)**
$$\llbracket \Sigma x : A.B \rrbracket_\rho = \sum_{a \in \llbracket A \rrbracket_\rho} \llbracket B \rrbracket_{\rho[x \mapsto a]}$$

### 5.2 操作语义

**定义 5.2.1 (依赖类型归约)**
依赖类型的归约规则：

1. **β归约**：$(\lambda x : A.e_1) e_2 \rightarrow e_1[e_2/x]$
2. **π归约**：$\text{fst } (e_1, e_2) \rightarrow e_1$
3. **σ归约**：$\text{snd } (e_1, e_2) \rightarrow e_2$

## 6. 依赖类型应用

### 6.1 向量类型

**定义 6.1.1 (向量类型)**
```lean
inductive Vec (α : Type) : Nat → Type where
  | nil : Vec α 0
  | cons : α → Vec α n → Vec α (n + 1)
```

**定理 6.1.1 (向量长度)**
向量的长度在类型中编码：

```lean
def length {α : Type} {n : Nat} (v : Vec α n) : Nat := n
```

### 6.2 相等类型

**定义 6.2.1 (相等类型)**
```lean
inductive Eq {α : Type} (a : α) : α → Type where
  | refl : Eq a a
```

**定理 6.2.1 (相等类型性质)**
相等类型满足：

1. **自反性**：$a = a$
2. **对称性**：$a = b \rightarrow b = a$
3. **传递性**：$a = b \rightarrow b = c \rightarrow a = c$

### 6.3 依赖函数示例

**定义 6.3.1 (安全索引)**
```lean
def safeIndex {α : Type} {n : Nat} (v : Vec α n) (i : Fin n) : α :=
  match v, i with
  | Vec.cons x _, Fin.mk 0 _ => x
  | Vec.cons _ xs, Fin.mk (i+1) h => safeIndex xs (Fin.mk i (Nat.lt_of_succ_lt_succ h))
  | Vec.nil, _ => absurd (Fin.mk i h) (Nat.not_lt_zero i h)
```

## 7. Lean中的依赖类型

### 7.1 依赖函数

```lean
-- 依赖函数类型
def dependentFunction (n : Nat) : Type :=
  match n with
  | 0 => Unit
  | n + 1 => Nat

-- 依赖函数实现
def dependentValue (n : Nat) : dependentFunction n :=
  match n with
  | 0 => ()
  | n + 1 => n
```

### 7.2 依赖积类型

```lean
-- 依赖积类型
def dependentPair (n : Nat) : Type :=
  (n : Nat) × (dependentFunction n)

-- 依赖积类型实现
def dependentPairValue : dependentPair 3 :=
  (3, 2)
```

## 8. 相关链接

### 8.1 上级主题
- [1.8 类型论理论模型](./1.8-类型论理论模型.md)

### 8.2 下级主题
- [1.8.2.1 Π类型（依赖函数类型）](./1.8.2.1-Π类型（依赖函数类型）.md)
- [1.8.2.2 Σ类型（依赖积类型）](./1.8.2.2-Σ类型（依赖积类型）.md)

### 8.3 相关主题
- [1.8.1 简单类型理论](./1.8.1-简单类型理论.md)
- [1.8.3 线性类型理论](./1.8.3-线性类型理论.md)
- [1.8.4 Martin-Löf类型论](./1.8.4-Martin-Löf类型论.md)

---

**最后更新**：2025-01-01  
**版本**：v2025-01  
**维护者**：Lean语义分析项目组
