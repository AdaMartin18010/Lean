# 5.2 IDEé›†æˆ / IDE Integration

[è¿”å›žç›®å½•](README.md) | [ä¸Šä¸€èŠ‚](5.1-å¼€å‘çŽ¯å¢ƒé…ç½®.md) | [ä¸‹ä¸€èŠ‚](5.3-ç¼–è¯‘å™¨é…ç½®.md)

---

## æ¦‚è¿° / Overview

IDEé›†æˆæ˜¯Leanè¯­è¨€å¼€å‘ä½“éªŒçš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œä¸ºå¼€å‘è€…æä¾›è¯­æ³•é«˜äº®ã€æ™ºèƒ½æç¤ºã€é”™è¯¯æ£€æŸ¥ã€è‡ªåŠ¨è¡¥å…¨ç­‰åŠŸèƒ½ã€‚æœ¬ç« è¯¦ç»†ä»‹ç»VS Codeã€Vimã€Emacsç­‰ä¸»æµç¼–è¾‘å™¨çš„Lean 4é›†æˆé…ç½®ï¼Œç¡®ä¿å¼€å‘è€…èƒ½å¤Ÿé«˜æ•ˆåœ°è¿›è¡ŒLeanè¯­è¨€å¼€å‘ã€‚

## 1. VS Codeé›†æˆ / VS Code Integration

### 1.1 æ‰©å±•å®‰è£… / Extension Installation

**å®šä¹‰ 1.1.1** (VS Codeæ‰©å±•) VS Codeçš„Lean 4æ‰©å±•ï¼š

```bash
# é€šè¿‡VS Codeæ‰©å±•å¸‚åœºå®‰è£…
code --install-extension leanprover.lean4

# æˆ–é€šè¿‡å‘½ä»¤è¡Œå®‰è£…
code --install-extension leanprover.lean4 --force
```

**é…ç½® 1.1.1** (æ‰©å±•é…ç½®) VS Codeæ‰©å±•çš„åŸºæœ¬é…ç½®ï¼š

```json
{
  "lean4.serverEnv": {
    "LEAN_SERVER_LOG_LEVEL": "INFO",
    "LEAN_SERVER_LOG_FILE": "lean-server.log"
  },
  "lean4.serverArgs": [
    "--server"
  ],
  "lean4.leanPath": "lean",
  "lean4.lakePath": "lake",
  "lean4.enableDiagnostics": true,
  "lean4.enableCompletion": true,
  "lean4.enableHover": true,
  "lean4.enableDefinition": true,
  "lean4.enableReferences": true
}
```

### 1.2 åŠŸèƒ½ç‰¹æ€§ / Features

**ç‰¹æ€§ 1.2.1** (è¯­æ³•é«˜äº®) Lean 4è¯­æ³•é«˜äº®æ”¯æŒï¼š

```lean
-- Lean 4 è¯­æ³•é«˜äº®ç¤ºä¾‹
namespace Lean4Syntax

-- å…³é”®å­—é«˜äº®
def example_function (x : Nat) : Nat :=
  match x with
  | 0 => 1
  | n + 1 => n * example_function n

-- ç±»åž‹é«˜äº®
structure Point where
  x : Float
  y : Float
  deriving Repr

-- æ³¨é‡Šé«˜äº®
/- è¿™æ˜¯å¤šè¡Œæ³¨é‡Š -/
-- è¿™æ˜¯å•è¡Œæ³¨é‡Š

end Lean4Syntax
```

**ç‰¹æ€§ 1.2.2** (æ™ºèƒ½æç¤º) æ™ºèƒ½æç¤ºå’Œè‡ªåŠ¨è¡¥å…¨ï¼š

```lean
-- æ™ºèƒ½æç¤ºç¤ºä¾‹
def smart_completion_example : List Nat â†’ Nat :=
  fun xs =>
    xs.foldl (fun acc x => acc + x) 0
    -- â†‘ è¿™é‡Œä¼šæ˜¾ç¤ºfoldlçš„ç±»åž‹ä¿¡æ¯
    -- â†‘ è¿™é‡Œä¼šæ˜¾ç¤ºå‚æ•°æç¤º
```

### 1.3 è°ƒè¯•æ”¯æŒ / Debugging Support

**å®šä¹‰ 1.3.1** (è°ƒè¯•é…ç½®) VS Codeè°ƒè¯•é…ç½®ï¼š

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Debug Lean 4",
      "type": "lean4",
      "request": "launch",
      "program": "${workspaceFolder}/Main.lean",
      "args": [],
      "cwd": "${workspaceFolder}",
      "env": {},
      "console": "integratedTerminal"
    }
  ]
}
```

## 2. Vim/Neovimé›†æˆ / Vim/Neovim Integration

### 2.1 æ’ä»¶å®‰è£… / Plugin Installation

**å®šä¹‰ 2.1.1** (Vimæ’ä»¶) Vimçš„Lean 4æ’ä»¶ï¼š

```vim
" ä½¿ç”¨vim-plugå®‰è£…
Plug 'leanprover/lean4', {'rtp': 'src/vim'}

" æˆ–ä½¿ç”¨Vundleå®‰è£…
Plugin 'leanprover/lean4'

" æˆ–ä½¿ç”¨Pathogenå®‰è£…
git clone https://github.com/leanprover/lean4.git ~/.vim/bundle/lean4
```

**é…ç½® 2.1.1** (Vimé…ç½®) Vimçš„Lean 4é…ç½®ï¼š

```vim
" Lean 4 é…ç½®
let g:lean4_server_options = ['--server']
let g:lean4_server_env = {
  \ 'LEAN_SERVER_LOG_LEVEL': 'INFO',
  \ 'LEAN_SERVER_LOG_FILE': 'lean-server.log'
  \ }

" è¯­æ³•é«˜äº®
syntax on
filetype plugin indent on

" è‡ªåŠ¨è¡¥å…¨
set completeopt=menu,menuone,noinsert,noselect
```

### 2.2 Neovimé›†æˆ / Neovim Integration

**å®šä¹‰ 2.2.1** (Neovimé…ç½®) Neovimçš„Lean 4é…ç½®ï¼š

```lua
-- Neovim Lean 4 é…ç½®
local lean4_config = {
  server = {
    cmd = { 'lean', '--server' },
    settings = {
      lean4 = {
        serverEnv = {
          LEAN_SERVER_LOG_LEVEL = 'INFO',
          LEAN_SERVER_LOG_FILE = 'lean-server.log'
        }
      }
    }
  }
}

-- ä½¿ç”¨nvim-lspconfig
require('lspconfig').lean4.setup(lean4_config)
```

## 3. Emacsé›†æˆ / Emacs Integration

### 3.1 åŒ…å®‰è£… / Package Installation

**å®šä¹‰ 3.1.1** (EmacsåŒ…) Emacsçš„Lean 4åŒ…ï¼š

```elisp
;; ä½¿ç”¨package.elå®‰è£…
(require 'package)
(add-to-list 'package-archives
             '("melpa" . "https://melpa.org/packages/"))
(package-initialize)

;; å®‰è£…lean4-mode
(package-install 'lean4-mode)
```

**é…ç½® 3.1.1** (Emacsé…ç½®) Emacsçš„Lean 4é…ç½®ï¼š

```elisp
;; Lean 4 é…ç½®
(require 'lean4-mode)

;; è‡ªåŠ¨åŠ è½½Leanæ–‡ä»¶
(add-to-list 'auto-mode-alist '("\\.lean\\'" . lean4-mode))

;; æœåŠ¡å™¨é…ç½®
(setq lean4-server-options '("--server"))
(setq lean4-server-env '((LEAN_SERVER_LOG_LEVEL . "INFO")
                         (LEAN_SERVER_LOG_FILE . "lean-server.log")))

;; è¯­æ³•é«˜äº®
(add-hook 'lean4-mode-hook
          (lambda ()
            (setq font-lock-defaults '(lean4-font-lock-keywords))))
```

### 3.2 åŠŸèƒ½é…ç½® / Feature Configuration

**é…ç½® 3.2.1** (EmacsåŠŸèƒ½) Emacsçš„Lean 4åŠŸèƒ½é…ç½®ï¼š

```elisp
;; è‡ªåŠ¨è¡¥å…¨
(require 'company)
(add-hook 'lean4-mode-hook 'company-mode)

;; é”™è¯¯æ£€æŸ¥
(require 'flycheck)
(add-hook 'lean4-mode-hook 'flycheck-mode)

;; ä»£ç æ ¼å¼åŒ–
(require 'format-all)
(add-hook 'lean4-mode-hook 'format-all-mode)
```

## 4. å…¶ä»–ç¼–è¾‘å™¨é›†æˆ / Other Editor Integration

### 4.1 Sublime Texté›†æˆ / Sublime Text Integration

**å®šä¹‰ 4.1.1** (Sublime Texté…ç½®) Sublime Textçš„Lean 4é…ç½®ï¼š

```json
{
  "name": "Lean 4",
  "scopeName": "source.lean4",
  "fileTypes": ["lean"],
  "patterns": [
    {
      "match": "\\b(def|theorem|lemma|structure|class|namespace|end)\\b",
      "name": "keyword.control.lean4"
    },
    {
      "match": "\\b(Nat|Int|Float|String|Bool|List|Array)\\b",
      "name": "support.type.lean4"
    }
  ]
}
```

### 4.2 Atomé›†æˆ / Atom Integration

**å®šä¹‰ 4.2.1** (Atomé…ç½®) Atomçš„Lean 4é…ç½®ï¼š

```json
{
  "name": "language-lean4",
  "version": "0.1.0",
  "description": "Lean 4 language support for Atom",
  "engines": {
    "atom": ">=1.0.0 <2.0.0"
  },
  "dependencies": {},
  "repository": {
    "type": "git",
    "url": "https://github.com/leanprover/lean4.git"
  },
  "license": "MIT"
}
```

## 5. è¯­è¨€æœåŠ¡å™¨åè®® / Language Server Protocol

### 5.1 LSPé…ç½® / LSP Configuration

**å®šä¹‰ 5.1.1** (LSPæœåŠ¡å™¨) Lean 4çš„LSPæœåŠ¡å™¨é…ç½®ï¼š

```json
{
  "name": "lean4",
  "command": "lean",
  "args": ["--server"],
  "env": {
    "LEAN_SERVER_LOG_LEVEL": "INFO",
    "LEAN_SERVER_LOG_FILE": "lean-server.log"
  },
  "capabilities": {
    "textDocumentSync": {
      "openClose": true,
      "change": 1,
      "willSave": false,
      "willSaveWaitUntil": false,
      "save": { "includeText": false }
    },
    "completionProvider": {
      "resolveProvider": true,
      "triggerCharacters": ["."]
    },
    "hoverProvider": true,
    "definitionProvider": true,
    "referencesProvider": true,
    "documentSymbolProvider": true,
    "workspaceSymbolProvider": true
  }
}
```

### 5.2 å®¢æˆ·ç«¯é…ç½® / Client Configuration

**å®šä¹‰ 5.2.1** (LSPå®¢æˆ·ç«¯) LSPå®¢æˆ·ç«¯çš„é…ç½®ï¼š

```json
{
  "lean4": {
    "server": {
      "command": "lean",
      "args": ["--server"],
      "env": {
        "LEAN_SERVER_LOG_LEVEL": "INFO"
      }
    },
    "features": {
      "completion": true,
      "hover": true,
      "definition": true,
      "references": true,
      "diagnostics": true
    }
  }
}
```

## 6. è°ƒè¯•é€‚é…å™¨åè®® / Debug Adapter Protocol

### 6.1 DAPé…ç½® / DAP Configuration

**å®šä¹‰ 6.1.1** (DAPæœåŠ¡å™¨) Lean 4çš„DAPæœåŠ¡å™¨é…ç½®ï¼š

```json
{
  "type": "lean4",
  "request": "launch",
  "name": "Debug Lean 4",
  "program": "${workspaceFolder}/Main.lean",
  "args": [],
  "cwd": "${workspaceFolder}",
  "env": {},
  "console": "integratedTerminal",
  "stopOnEntry": false,
  "showReturnValue": true
}
```

### 6.2 è°ƒè¯•åŠŸèƒ½ / Debugging Features

**åŠŸèƒ½ 6.2.1** (è°ƒè¯•ç‰¹æ€§) Lean 4çš„è°ƒè¯•ç‰¹æ€§ï¼š

```lean
-- è°ƒè¯•ç¤ºä¾‹
def debug_example (x : Nat) : Nat :=
  let y := x + 1
  let z := y * 2
  -- åœ¨è¿™é‡Œè®¾ç½®æ–­ç‚¹
  z + 1
```

## 7. æ€§èƒ½ä¼˜åŒ– / Performance Optimization

### 7.1 æœåŠ¡å™¨ä¼˜åŒ– / Server Optimization

**ä¼˜åŒ– 7.1.1** (æœåŠ¡å™¨æ€§èƒ½) Lean 4æœåŠ¡å™¨æ€§èƒ½ä¼˜åŒ–ï¼š

```json
{
  "lean4.serverOptions": [
    "--server",
    "--memory=4096",
    "--threads=4"
  ],
  "lean4.serverEnv": {
    "LEAN_SERVER_LOG_LEVEL": "WARN",
    "LEAN_SERVER_CACHE_SIZE": "1024"
  }
}
```

### 7.2 å®¢æˆ·ç«¯ä¼˜åŒ– / Client Optimization

**ä¼˜åŒ– 7.2.1** (å®¢æˆ·ç«¯æ€§èƒ½) å®¢æˆ·ç«¯æ€§èƒ½ä¼˜åŒ–ï¼š

```json
{
  "lean4.clientOptions": {
    "maxCompletions": 100,
    "maxHoverLength": 1000,
    "diagnosticDelay": 500,
    "completionDelay": 300
  }
}
```

## 8. æ•…éšœæŽ’é™¤ / Troubleshooting

### 8.1 å¸¸è§é—®é¢˜ / Common Issues

**é—®é¢˜ 8.1.1** (è¿žæŽ¥é—®é¢˜) æœåŠ¡å™¨è¿žæŽ¥é—®é¢˜ï¼š

```bash
# æ£€æŸ¥LeanæœåŠ¡å™¨çŠ¶æ€
lean --server --help

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -an | grep 8080

# é‡å¯æœåŠ¡å™¨
pkill lean
lean --server
```

**é—®é¢˜ 8.1.2** (é…ç½®é—®é¢˜) é…ç½®é—®é¢˜è¯Šæ–­ï¼š

```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat ~/.lean/config.json

# éªŒè¯çŽ¯å¢ƒå˜é‡
echo $LEAN_PATH
echo $LAKE_PATH

# æµ‹è¯•æœåŠ¡å™¨è¿žæŽ¥
curl http://localhost:8080/health
```

### 8.2 è§£å†³æ–¹æ¡ˆ / Solutions

**è§£å†³æ–¹æ¡ˆ 8.2.1** (é—®é¢˜ä¿®å¤) å¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼š

1. **æœåŠ¡å™¨æ— æ³•å¯åŠ¨**ï¼š
   - æ£€æŸ¥Leanå®‰è£…
   - éªŒè¯é…ç½®æ–‡ä»¶
   - æ£€æŸ¥ç«¯å£å ç”¨

2. **è¯­æ³•é«˜äº®ä¸å·¥ä½œ**ï¼š
   - é‡æ–°å®‰è£…æ‰©å±•
   - æ£€æŸ¥æ–‡ä»¶å…³è”
   - éªŒè¯è¯­æ³•æ–‡ä»¶

3. **è‡ªåŠ¨è¡¥å…¨ä¸å·¥ä½œ**ï¼š
   - æ£€æŸ¥LSPè¿žæŽ¥
   - éªŒè¯æœåŠ¡å™¨çŠ¶æ€
   - é‡å¯è¯­è¨€æœåŠ¡å™¨

## 9. æœ€ä½³å®žè·µ / Best Practices

### 9.1 é…ç½®ç®¡ç† / Configuration Management

**å®žè·µ 9.1.1** (é…ç½®æœ€ä½³å®žè·µ) é…ç½®ç®¡ç†çš„æœ€ä½³å®žè·µï¼š

1. **ç‰ˆæœ¬æŽ§åˆ¶**ï¼šå°†é…ç½®æ–‡ä»¶çº³å…¥ç‰ˆæœ¬æŽ§åˆ¶
2. **çŽ¯å¢ƒéš”ç¦»**ï¼šä¸ºä¸åŒçŽ¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®
3. **å¤‡ä»½æ¢å¤**ï¼šå®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶
4. **æ–‡æ¡£è®°å½•**ï¼šè®°å½•é…ç½®å˜æ›´å’ŒåŽŸå› 

### 9.2 æ€§èƒ½è°ƒä¼˜ / Performance Tuning

**å®žè·µ 9.2.1** (æ€§èƒ½è°ƒä¼˜) æ€§èƒ½è°ƒä¼˜çš„æœ€ä½³å®žè·µï¼š

1. **å†…å­˜ç®¡ç†**ï¼šåˆç†è®¾ç½®å†…å­˜é™åˆ¶
2. **å¹¶å‘æŽ§åˆ¶**ï¼šä¼˜åŒ–çº¿ç¨‹æ•°é‡
3. **ç¼“å­˜ç­–ç•¥**ï¼šåˆç†ä½¿ç”¨ç¼“å­˜
4. **èµ„æºç›‘æŽ§**ï¼šç›‘æŽ§èµ„æºä½¿ç”¨æƒ…å†µ

## 10. æ€»ç»“ä¸Žå±•æœ› / Summary and Outlook

### 10.1 æ ¸å¿ƒè´¡çŒ® / Core Contributions

1. **å®Œæ•´é›†æˆ**ï¼šæä¾›äº†ä¸»æµç¼–è¾‘å™¨çš„å®Œæ•´é›†æˆæ–¹æ¡ˆ
2. **åŠŸèƒ½ä¸°å¯Œ**ï¼šæ”¯æŒè¯­æ³•é«˜äº®ã€æ™ºèƒ½æç¤ºã€è°ƒè¯•ç­‰åŠŸèƒ½
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šæä¾›äº†æ€§èƒ½ä¼˜åŒ–å’Œè°ƒä¼˜æŒ‡å—
4. **æ•…éšœæŽ’é™¤**ï¼šå»ºç«‹äº†å®Œæ•´çš„æ•…éšœæŽ’é™¤ä½“ç³»

### 10.2 æœªæ¥æ–¹å‘ / Future Directions

1. **åŠŸèƒ½æ‰©å±•**ï¼šç»§ç»­æ‰©å±•IDEé›†æˆåŠŸèƒ½
2. **æ€§èƒ½ä¼˜åŒ–**ï¼šè¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½å’Œå“åº”é€Ÿåº¦
3. **ç”¨æˆ·ä½“éªŒ**ï¼šæ”¹å–„ç”¨æˆ·ç•Œé¢å’Œäº¤äº’ä½“éªŒ
4. **ç¤¾åŒºæ”¯æŒ**ï¼šåŠ å¼ºç¤¾åŒºæ”¯æŒå’Œæ–‡æ¡£å®Œå–„

---

## äº¤å‰å¼•ç”¨ / Cross-References

- **ä¸Šä¸€èŠ‚**ï¼š[5.1 å¼€å‘çŽ¯å¢ƒé…ç½®](5.1-å¼€å‘çŽ¯å¢ƒé…ç½®.md)
- **ä¸‹ä¸€èŠ‚**ï¼š[5.3 ç¼–è¯‘å™¨é…ç½®](5.3-ç¼–è¯‘å™¨é…ç½®.md)
- **ä¸Šä½ä¸»é¢˜**ï¼š[5. å·¥å…·é›†æˆæŒ‡å—](README.md)
- **ä¸‹ä½ç»†åˆ†ä¸»é¢˜**ï¼š
  - [5.2.1 VS Codeé›†æˆè¯¦è§£](5.2.1-VS-Codeé›†æˆè¯¦è§£.md)
  - [5.2.2 Vimé›†æˆè¯¦è§£](5.2.2-Vimé›†æˆè¯¦è§£.md)
  - [5.2.3 Emacsé›†æˆè¯¦è§£](5.2.3-Emacsé›†æˆè¯¦è§£.md)

## å‚è€ƒèµ„æ–™ / References

1. **å®˜æ–¹æ–‡æ¡£**ï¼š
   - [Lean 4 VS Codeæ‰©å±•](https://marketplace.visualstudio.com/items?itemName=leanprover.lean4)
   - [Lean 4 Vimæ’ä»¶](https://github.com/leanprover/lean4)
   - [Lean 4 EmacsåŒ…](https://github.com/leanprover/lean4)

2. **æŠ€æœ¯æ–‡æ¡£**ï¼š
   - [Language Server Protocol](https://microsoft.github.io/language-server-protocol/)
   - [Debug Adapter Protocol](https://microsoft.github.io/debug-adapter-protocol/)

3. **ç¤¾åŒºèµ„æº**ï¼š
   - [Lean ç¤¾åŒºè®ºå›](https://leanprover-community.github.io/)
   - [Lean 4 GitHubä»“åº“](https://github.com/leanprover/lean4)

---

## å˜æ›´è®°å½• / Change Log

### v2025-01-01

- åˆå§‹ç‰ˆæœ¬åˆ›å»º
- æ·»åŠ VS Codeã€Vimã€Emacsé›†æˆé…ç½®
- å»ºç«‹LSPå’ŒDAPåè®®æ”¯æŒ
- æ·»åŠ æ€§èƒ½ä¼˜åŒ–å’Œæ•…éšœæŽ’é™¤æŒ‡å—
- å»ºç«‹æœ€ä½³å®žè·µå’Œæœªæ¥å‘å±•æ–¹å‘

---

*æœ€åŽæ›´æ–°ï¼š2025-09-11*  
*ç‰ˆæœ¬ï¼šv2025-09*  
*çŠ¶æ€ï¼šè¿›è¡Œä¸­ ðŸ”„*
