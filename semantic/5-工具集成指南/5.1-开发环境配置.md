# 5.1 开发环境配置 / Development Environment Setup

[返回目录](../README.md) | [下一节](5.2-IDE集成.md)

---

## 概述 / Overview

本文档提供Lean语言开发环境的完整配置指南，包括系统要求、安装步骤、环境配置和验证方法。我们将从基础环境开始，逐步配置完整的Lean开发环境，确保用户能够顺利开始Lean语言的学习和开发。

## 1. 系统要求 / System Requirements

### 1.1 硬件要求 / Hardware Requirements

**最低配置**：

- **CPU**：双核处理器，2.0GHz以上
- **内存**：4GB RAM（推荐8GB以上）
- **存储**：10GB可用磁盘空间
- **网络**：稳定的互联网连接

**推荐配置**：

- **CPU**：四核处理器，3.0GHz以上
- **内存**：16GB RAM
- **存储**：50GB可用磁盘空间（SSD推荐）
- **网络**：高速互联网连接

### 1.2 操作系统支持 / Operating System Support

**Windows**：

- Windows 10 版本1903或更高版本
- Windows 11（推荐）
- 支持WSL2（Windows Subsystem for Linux）

**macOS**：

- macOS 10.15（Catalina）或更高版本
- macOS 11（Big Sur）或更高版本（推荐）
- 支持Apple Silicon（M1/M2）和Intel处理器

**Linux**：

- Ubuntu 18.04 LTS或更高版本
- Debian 10或更高版本
- CentOS 8或更高版本
- 其他主流Linux发行版

## 2. 基础环境安装 / Basic Environment Installation

### 2.1 安装Git / Install Git

**Windows**：

```powershell
# 使用Chocolatey安装
choco install git

# 或下载安装包
# https://git-scm.com/download/win
```

**macOS**：

```bash
# 使用Homebrew安装
brew install git

# 或使用Xcode Command Line Tools
xcode-select --install
```

**Linux**：

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install git

# CentOS/RHEL
sudo yum install git
# 或
sudo dnf install git
```

**验证安装**：

```bash
git --version
```

### 2.2 安装Node.js / Install Node.js

**Windows**：

```powershell
# 使用Chocolatey安装
choco install nodejs

# 或下载安装包
# https://nodejs.org/
```

**macOS**：

```bash
# 使用Homebrew安装
brew install node

# 或使用nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install node
```

**Linux**：

```bash
# Ubuntu/Debian
curl -fsSL https://deb.nodesource.com/setup_lts.x | sudo -E bash -
sudo apt-get install -y nodejs

# CentOS/RHEL
curl -fsSL https://rpm.nodesource.com/setup_lts.x | sudo bash -
sudo yum install -y nodejs
```

**验证安装**：

```bash
node --version
npm --version
```

### 2.3 安装Python / Install Python

**Windows**：

```powershell
# 使用Chocolatey安装
choco install python

# 或下载安装包
# https://www.python.org/downloads/
```

**macOS**：

```bash
# 使用Homebrew安装
brew install python

# 或使用pyenv
brew install pyenv
pyenv install 3.11.0
pyenv global 3.11.0
```

**Linux**：

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install python3 python3-pip

# CentOS/RHEL
sudo yum install python3 python3-pip
# 或
sudo dnf install python3 python3-pip
```

**验证安装**：

```bash
python3 --version
pip3 --version
```

## 3. Lean 4安装 / Lean 4 Installation

### 3.1 安装Elan / Install Elan

**Elan**是Lean 4的版本管理工具，类似于Rust的rustup。

**Windows**：

```powershell
# 使用PowerShell安装
Invoke-WebRequest -Uri "https://raw.githubusercontent.com/leanprover/elan/master/elan-init.ps1" -OutFile "elan-init.ps1"
.\elan-init.ps1

# 或使用Chocolatey
choco install elan
```

**macOS**：

```bash
# 使用curl安装
curl https://raw.githubusercontent.com/leanprover/elan/master/elan-init.sh -sSf | sh

# 或使用Homebrew
brew install elan
```

**Linux**：

```bash
# 使用curl安装
curl https://raw.githubusercontent.com/leanprover/elan/master/elan-init.sh -sSf | sh
```

**验证安装**：

```bash
elan --version
lean --version
```

### 3.2 安装Lean 4 / Install Lean 4

**安装最新稳定版**：

```bash
elan toolchain install stable
elan default stable
```

**安装特定版本**：

```bash
# 查看可用版本
elan toolchain list

# 安装特定版本
elan toolchain install 4.0.0
elan default 4.0.0
```

**验证安装**：

```bash
lean --version
lean --help
```

### 3.3 安装Lake / Install Lake

**Lake**是Lean 4的包管理器和构建工具。

**安装Lake**：

```bash
# Lake通常随Lean 4一起安装
lake --version

# 如果没有安装，可以手动安装
elan toolchain install stable
elan default stable
```

**验证安装**：

```bash
lake --version
lake --help
```

## 4. 开发工具安装 / Development Tools Installation

### 4.1 安装VS Code / Install VS Code

**Windows**：

```powershell
# 使用Chocolatey安装
choco install vscode

# 或下载安装包
# https://code.visualstudio.com/
```

**macOS**：

```bash
# 使用Homebrew安装
brew install --cask visual-studio-code

# 或从App Store安装
```

**Linux**：

```bash
# Ubuntu/Debian
wget -qO- https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > packages.microsoft.gpg
sudo install -o root -g root -m 644 packages.microsoft.gpg /etc/apt/trusted.gpg.d/
sudo sh -c 'echo "deb [arch=amd64,arm64,armhf signed-by=/etc/apt/trusted.gpg.d/packages.microsoft.gpg] https://packages.microsoft.com/repos/code stable main" > /etc/apt/sources.list.d/vscode.list'
sudo apt update
sudo apt install code

# CentOS/RHEL
sudo rpm --import https://packages.microsoft.com/keys/microsoft.asc
sudo sh -c 'echo -e "[code]\nname=Visual Studio Code\nbaseurl=https://packages.microsoft.com/yumrepos/vscode\nenabled=1\ngpgcheck=1\ngpgkey=https://packages.microsoft.com/keys/microsoft.asc" > /etc/yum.repos.d/vscode.repo'
sudo yum install code
```

**验证安装**：

```bash
code --version
```

### 4.2 安装Lean 4扩展 / Install Lean 4 Extension

**通过VS Code安装**：

1. 打开VS Code
2. 按`Ctrl+Shift+X`（Windows/Linux）或`Cmd+Shift+X`（macOS）打开扩展面板
3. 搜索"Lean 4"
4. 安装"Lean 4"扩展

**通过命令行安装**：

```bash
code --install-extension leanprover.lean4
```

**验证安装**：

1. 打开VS Code
2. 检查扩展是否已安装并启用
3. 创建新的`.lean`文件测试语法高亮

### 4.3 安装其他有用扩展 / Install Other Useful Extensions

**推荐扩展**：

```bash
# 安装多个扩展
code --install-extension ms-vscode.vscode-json
code --install-extension redhat.vscode-yaml
code --install-extension ms-vscode.powershell
code --install-extension ms-python.python
code --install-extension ms-vscode.cpptools
```

**扩展列表**：

- **JSON**：JSON文件支持
- **YAML**：YAML文件支持
- **PowerShell**：PowerShell支持
- **Python**：Python支持
- **C/C++**：C/C++支持

## 5. 项目配置 / Project Configuration

### 5.1 创建新项目 / Create New Project

**使用Lake创建项目**：

```bash
# 创建新项目
lake new my_lean_project

# 进入项目目录
cd my_lean_project

# 查看项目结构
ls -la
```

**项目结构**：

```text
my_lean_project/
├── MyLeanProject/
│   ├── Basic.lean
│   └── Main.lean
├── lakefile.lean
├── lean-toolchain
└── README.md
```

### 5.2 配置lakefile.lean / Configure lakefile.lean

**基本配置**：

```lean
import Lake
open Lake DSL

package «my_lean_project» where
  -- 包配置

@[default_target]
lean_lib «MyLeanProject» where
  -- 库配置
```

**添加依赖**：

```lean
import Lake
open Lake DSL

package «my_lean_project» where
  -- 包配置

require mathlib from git
  "https://github.com/leanprover-community/mathlib4.git"

@[default_target]
lean_lib «MyLeanProject» where
  -- 库配置
```

### 5.3 配置lean-toolchain / Configure lean-toolchain

**指定Lean版本**：

```text
leanprover/lean4:v4.0.0
```

**使用最新版本**：

```text
leanprover/lean4:stable
```

## 6. 环境验证 / Environment Verification

### 6.1 验证Lean安装 / Verify Lean Installation

**检查版本**：

```bash
lean --version
elan --version
lake --version
```

**测试基本功能**：

```bash
# 创建测试文件
echo 'def hello : String := "Hello, Lean!"' > test.lean

# 编译测试文件
lean test.lean

# 检查是否有错误
echo $?
```

### 6.2 验证VS Code集成 / Verify VS Code Integration

**测试步骤**：

1. 打开VS Code
2. 创建新文件`test.lean`
3. 输入以下代码：

    ```lean
    def hello : String := "Hello, Lean!"
    #check hello
    ```

4. 保存文件
5. 检查是否有语法高亮和错误提示

### 6.3 验证项目构建 / Verify Project Build

**构建项目**：

```bash
# 进入项目目录
cd my_lean_project

# 构建项目
lake build

# 检查构建结果
ls -la build/
```

**运行测试**：

```bash
# 运行项目测试
lake test

# 检查测试结果
echo $?
```

## 7. 常见问题解决 / Common Issues and Solutions

### 7.1 安装问题 / Installation Issues

**问题1：elan安装失败**:

```bash
# 解决方案：手动下载安装
curl -L https://github.com/leanprover/elan/releases/latest/download/elan-x86_64-unknown-linux-gnu.tar.gz | tar xz
./elan-init -y
```

**问题2：Lean版本不匹配**:

```bash
# 解决方案：更新工具链
elan self update
elan toolchain install stable
elan default stable
```

**问题3：VS Code扩展不工作**:

```bash
# 解决方案：重新安装扩展
code --uninstall-extension leanprover.lean4
code --install-extension leanprover.lean4
```

### 7.2 配置问题 / Configuration Issues

**问题1：项目构建失败**:

```bash
# 解决方案：清理并重新构建
lake clean
lake build
```

**问题2：依赖下载失败**:

```bash
# 解决方案：手动更新依赖
lake update
lake build
```

**问题3：路径问题**:

```bash
# 解决方案：检查环境变量
echo $PATH
which lean
which lake
```

### 7.3 性能问题 / Performance Issues

**问题1：编译速度慢**:

```bash
# 解决方案：增加并行度
export LEAN_CC="gcc -j$(nproc)"
lake build
```

**问题2：内存不足**:

```bash
# 解决方案：限制内存使用
export LEAN_MEMORY_LIMIT=4096
lake build
```

## 8. 高级配置 / Advanced Configuration

### 8.1 自定义构建配置 / Custom Build Configuration

**lakefile.lean高级配置**：

```lean
import Lake
open Lake DSL

package «my_lean_project» where
  -- 包配置
  version := "0.1.0"
  dependencies := #[]

require mathlib from git
  "https://github.com/leanprover-community/mathlib4.git"

@[default_target]
lean_lib «MyLeanProject» where
  -- 库配置
  roots := #[`MyLeanProject]

lean_exe «my_lean_project» where
  root := `Main
  supportInterpreter := true
```

### 8.2 开发工具配置 / Development Tools Configuration

**VS Code设置**：

```json
{
  "lean4.serverLogging.enabled": true,
  "lean4.serverLogging.path": "~/.lean/logs",
  "lean4.serverLogging.level": "info",
  "lean4.serverLogging.verbosity": 1
}
```

**Git配置**：

```bash
# 配置Git用户信息
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"

# 配置Git编辑器
git config --global core.editor "code --wait"
```

### 8.3 性能优化 / Performance Optimization

**系统优化**：

```bash
# 增加文件描述符限制
ulimit -n 65536

# 优化内存使用
export LEAN_MEMORY_LIMIT=8192

# 启用并行编译
export LEAN_CC="gcc -j$(nproc)"
```

## 9. 交叉引用 / Cross-References

### 9.1 相关章节 / Related Sections

- [5.2 IDE集成](5.2-IDE集成.md)
- [5.3 编译器配置](5.3-编译器配置.md)
- [5.4 包管理](5.4-包管理.md)
- [5.5 调试工具](5.5-调试工具.md)

### 9.2 外部资源 / External Resources

- [Lean 4 官方文档](https://leanprover.github.io/lean4/doc/)
- [Elan 安装指南](https://github.com/leanprover/elan)
- [Lake 包管理器](https://github.com/leanprover/lake)
- [VS Code Lean 4 扩展](https://marketplace.visualstudio.com/items?itemName=leanprover.lean4)

---

## 变更记录 / Change Log

### v2025-01-01

- 初始版本创建
- 建立完整的开发环境配置指南
- 涵盖所有主流操作系统
- 提供详细的安装和配置步骤

---

*最后更新：2025-01-01*  
*版本：v2025-01*  
*状态：已完成 ✅*
